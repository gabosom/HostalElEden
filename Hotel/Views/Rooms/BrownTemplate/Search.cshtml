@model HotelEden.Models.RoomTypesReservationViewModel

@{
    ViewBag.Title = HotelEden.SpanishResources.SiteRoomsTitle;
    Layout = "~/Views/Shared/_Template.cshtml";
}

<h2>@HotelEden.SpanishResources.RoomsTitle</h2>
@String.Format(HotelEden.SpanishResources.RoomsSearchDescription,Model.CheckInDate.ToShortDateString(), Model.CheckOutDate.ToShortDateString())

@using (Html.BeginForm("Reserve","Rooms",FormMethod.Get)) {
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)


    @Html.HiddenFor(model => model.CheckInDate)            
    @Html.HiddenFor(model => model.CheckOutDate)

    <table class="roomList">
        <tr>
            <th colspan="2"></th>
            <th>@HotelEden.SpanishResources.RoomsCostColumn</th>
            <th>@HotelEden.SpanishResources.RoomsCountColumn</th>
            <th><input class="RoomsSelectRoom disabledNextButton" type="submit" value="@HotelEden.SpanishResources.RoomsValidateCount" /></th>
        </tr>
        <tr class="roomListItemBreak">
            <td colspan="5">
                <hr />
            </td>
        </tr>

        @foreach (HotelEden.Models.RoomType item in (List<HotelEden.Models.RoomType>)ViewBag.AllRooms)
        {
            <tr class="roomListItem">
                <td class="roomThumbColumn">
                    <img src="@Html.DisplayFor(modelItem => item.ImageURL)" />
                </td>
                <td class="roomTitleColumn">
                    <h3>@Html.DisplayFor(modelItem => item.Title)</h3>
                    <div>
                        @for (int i = 0; i < item.MaxGuestNo; i++)
                        {
                            <span class="roomOccupant"></span>
                        }
                    </div>
                    <span>@Html.Raw(item.Description)</span>
                </td>
                <td class="priceColumn">
                    USD $@String.Format("{0:0.00}", item.Rate)
                </td>
                <td class="maxGuestsColumn">
                    @{
                        var fieldCountName = item.Keyword + "Count";
                    }
                    <select name="@fieldCountName">
                        @for (int i = 0; i < 4; i++ )
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </td>
                
                <td class="selectColumn">
                    @*@Html.ActionLink(HotelEden.SpanishResources.RoomsSelectRoom, "Reserve", "Rooms", new { room = item.URL }, null)*@
                </td>
            </tr>
            <tr class="roomListItemBreak">
                <td colspan="5">
                    <hr />
                </td>
            </tr>
        }

        <tr>
            <td colspan="2"></td>
            <td></td>
            <td></td>
            <td><input class="RoomsSelectRoom disabledNextButton" type="submit" value="@HotelEden.SpanishResources.RoomsValidateCount" /></td>
        </tr>
    </table>


        <p>
            <input type="submit" value="Save" />
        </p>

}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $(document).ready(function () {
            $("select[name$='Count']").change(function () {
                totalRoomCount = 0;
                
                $("select[name$='Count']").each(function (index) {
                    totalRoomCount += parseInt($(this).val()); //val() is treated as string othrewise
                    
                });
                
                if(totalRoomCount > 0)
                {
                    $(".RoomsSelectRoom").removeClass("disabledNextButton").val("@HotelEden.SpanishResources.RoomsContinueAsValid");
                    
                }
                else
                {
                    $(".RoomsSelectRoom").addClass("disabledNextButton").val("@HotelEden.SpanishResources.RoomsValidateCount");
                }

            });
        });
    </script>
}
